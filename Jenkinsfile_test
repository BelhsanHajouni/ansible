pipeline {
    agent any

   environment {
       VAULT_PASS = credentials('ansible_vault_password') // Use your credentials ID
    }

    tools {
        ansible 'Ansible'
    }
    stages {
        stage('Git Checkout') {
            steps {
                echo 'Pulling ... '
                git branch: 'main',
                url: 'https://github.com/jasminemansouri/ansible'
            }
        }
        stage('test') {
            steps {
                 script {
                        echo "Workspace: ${env.WORKSPACE}"
                    }

                // Retrieve the Vault password from Jenkins credentials store
                withCredentials([string(credentialsId: 'ansible_vault_password', variable: 'VAULT_PASS')]) {
                    script {
                        // Write the vault password to a temporary file
                        writeFile file: 'vault_password.txt', text: env.VAULT_PASS
                        sh 'echo env.VAULT_PASS'

                        // Run Ansible playbook for configuring VM IPs
                        sudo sh 'ansible-playbook -i hosts.ini test.yml --vault-password-file vault_password.txt'
                         //sh 'ansible-playbook -i hosts.ini test.yml --vault-password-string env.VAULT_PASS'
                          //sh 'ansible-playbook -i hosts_copy.ini test.yml'

                        // Clean up the temporary vault password file
                         sh 'rm -f vault_password.txt'
                    }
                }
            }
       
        }
    }
}
